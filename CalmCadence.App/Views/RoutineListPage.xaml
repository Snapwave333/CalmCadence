<Page
    x:Class="CalmCadence.App.Views.RoutineListPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:local="using:CalmCadence.App.ViewModels"
    mc:Ignorable="d">

    <Grid Padding="40" RowSpacing="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Stretch">
            <Button
                Content="← Back"
                Click="OnBackClicked"
                Style="{StaticResource AccentButtonStyle}"
                Margin="0,0,20,0"
                VerticalAlignment="Center" />

            <StackPanel VerticalAlignment="Center">
                <TextBlock
                    Text="Routine Management"
                    Style="{ThemeResource TitleTextBlockStyle}"
                    Margin="0,0,0,4" />
                <TextBlock
                    Text="Create and manage automated workflows"
                    Opacity="0.7"
                    FontSize="14" />
            </StackPanel>
        </StackPanel>

        <!-- Action Bar -->
        <Border Grid.Row="1" CornerRadius="8" Padding="16" BorderThickness="1">
            <Border.BorderBrush>
                <SolidColorBrush Color="{ThemeResource CardStrokeColorDefault}" />
            </Border.BorderBrush>
            <StackPanel Orientation="Horizontal" Spacing="12">
                <Button
                    Content="➕ New Routine"
                    Click="OnAddRoutineClicked"
                    Style="{StaticResource AccentButtonStyle}" />

                <Button
                    Content="🔄 Refresh"
                    Click="OnRefreshClicked"
                    Style="{StaticResource DefaultButtonStyle}" />
            </StackPanel>
        </Border>

        <!-- Routines List -->
        <Border Grid.Row="2" CornerRadius="8" BorderThickness="1">
            <Border.BorderBrush>
                <SolidColorBrush Color="{ThemeResource CardStrokeColorDefault}" />
            </Border.BorderBrush>

            <!-- Loading State -->
            <ProgressRing
                IsActive="{Binding IsLoading}"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Width="48"
                Height="48" />

            <!-- Empty State -->
            <StackPanel
                x:Name="EmptyStatePanel"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Spacing="16"
                Visibility="{Binding HasRoutines, Converter={StaticResource BooleanToVisibilityConverter}}">
                <TextBlock
                    Text="No routines yet"
                    FontSize="18"
                    FontWeight="SemiBold"
                    HorizontalAlignment="Center" />
                <TextBlock
                    Text="Create your first automated routine to get started"
                    Opacity="0.7"
                    HorizontalAlignment="Center" />
                <Button
                    Content="Create Your First Routine"
                    Click="OnAddRoutineClicked"
                    Style="{StaticResource AccentButtonStyle}" />
            </StackPanel>

            <!-- Routines ListView -->
            <ListView
                x:Name="RoutinesListView"
                ItemsSource="{Binding Routines}"
                SelectionMode="None"
                Visibility="{Binding HasRoutines, Converter={StaticResource BooleanToVisibilityConverter}}">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Border
                            CornerRadius="6"
                            BorderThickness="1"
                            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            Margin="0,4,0,4"
                            Padding="16">
                            <Grid ColumnSpacing="16">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Routine Info -->
                                <StackPanel Grid.Column="0" VerticalAlignment="Center" Spacing="4">
                                    <TextBlock
                                        Text="{Binding Name}"
                                        FontSize="16"
                                        FontWeight="SemiBold" />
                                    <TextBlock
                                        Text="{Binding Description}"
                                        Opacity="0.7"
                                        TextWrapping="Wrap"
                                        MaxWidth="400" />
                                    <StackPanel Orientation="Horizontal" Spacing="12" Opacity="0.6">
                                        <TextBlock
                                            Text="{Binding StepsCount, StringFormat='{}{0} steps'}"
                                            FontSize="12" />
                                        <TextBlock
                                            Text="{Binding CreatedAt, StringFormat='Created {}'}"
                                            FontSize="12" />
                                    </StackPanel>
                                </StackPanel>

                                <!-- Action Buttons -->
                                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                    <Button
                                        Content="▶️ Run"
                                        Click="OnRunRoutineClicked"
                                        Tag="{Binding Id}"
                                        Style="{StaticResource AccentButtonStyle}"
                                        FontSize="12"
                                        Padding="12,6" />

                                    <Button
                                        Content="✏️ Edit"
                                        Click="OnEditRoutineClicked"
                                        Tag="{Binding Id}"
                                        Style="{StaticResource DefaultButtonStyle}"
                                        FontSize="12"
                                        Padding="12,6" />
                                </StackPanel>

                                <!-- Context Menu -->
                                <Button Grid.Column="2" VerticalAlignment="Center">
                                    <Button.Content>
                                        <TextBlock Text="⋮" FontSize="16" />
                                    </Button.Content>
                                    <Button.Flyout>
                                        <MenuFlyout>
                                            <MenuFlyoutItem
                                                Text="Duplicate"
                                                Click="OnDuplicateRoutineClicked"
                                                Tag="{Binding Id}">
                                                <MenuFlyoutItem.Icon>
                                                    <FontIcon Glyph="&#xE8C8;" />
                                                </MenuFlyoutItem.Icon>
                                            </MenuFlyoutItem>
                                            <MenuFlyoutSeparator />
                                            <MenuFlyoutItem
                                                Text="Delete"
                                                Click="OnDeleteRoutineClicked"
                                                Tag="{Binding Id}"
                                                Foreground="Red">
                                                <MenuFlyoutItem.Icon>
                                                    <FontIcon Glyph="&#xE74D;" />
                                                </MenuFlyoutItem.Icon>
                                            </MenuFlyoutItem>
                                        </MenuFlyout>
                                    </Button.Flyout>
                                </Button>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </Border>
    </Grid>
</Page>
